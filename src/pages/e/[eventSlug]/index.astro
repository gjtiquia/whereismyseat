---
import BaseLayout from "../../../layouts/Layout.astro";
import type { EventData, GuestData } from "../../../scripts/config.ts";
import { tryGetEventDataAsync } from "../../../scripts/db";

export const prerender = false;

const { eventSlug } = Astro.params;
if (!eventSlug) return Astro.redirect("/");

const event = await tryGetEventDataAsync(eventSlug);
if (event == null)
    return new Response(null, {
        status: 404,
        statusText: `Cannot find event ${eventSlug}`,
    });

const guests = event.guests;

/*
 * ways to implement dropdown
 *
 * datalist
 * - does not show a list in Android
 *
 * select
 * - <select> and <option> and <optgroup>
 * - but this has no "search", is scrolling and finding, but simple
 * - tried but the styling is not consistent and cannot control
 *
 * custom
 * - can implement search and filter
 * - but time consuming
 * - https://css-tricks.com/striking-a-balance-between-native-and-custom-select-elements/
 * - here is a good article about striking a balance between native and custom select elements
 * - for this particular use case, almost all guests are guaranteed to be on mobile, so dont need to consider too much about keyboard navigation
 * */
---

<BaseLayout>
    <div
        data-event-home-page
        data-event-slug={eventSlug}
        class="min-h-dvh bg-gradient-to-br from-orange-50 via-rose-50 to-emerald-50 p-4 flex flex-col"
    >
        <!-- Main content container -->
        <div
            class="relative z-10 flex flex-col gap-6 max-w-md mx-auto w-full flex-grow"
        >
            <!-- Welcome Header -->
            <section class="text-center py-6">
                <div class="mb-4">
                    <div class="text-5xl mb-3">üëã</div>
                    <h1
                        class="font-serif text-3xl md:text-4xl text-stone-700 mb-3"
                    >
                        Welcome to the Celebration!
                    </h1>
                    <p class="text-stone-500 text-lg leading-relaxed">
                        Let's find your seat and get this party started! ‚ú®
                    </p>
                </div>

                <!-- Decorative divider -->
                <div class="flex items-center justify-center">
                    <div class="w-8 h-px bg-stone-300"></div>
                    <div class="mx-3 text-stone-400">üíï</div>
                    <div class="w-8 h-px bg-stone-300"></div>
                </div>
            </section>

            <!-- Name Input Section -->
            <section class="space-y-4">
                <div
                    class="bg-white/60 backdrop-blur-sm rounded-2xl p-6 shadow-lg border border-white/20"
                >
                    <label
                        for="guest-name-input"
                        class="block text-stone-600 font-semibold text-lg mb-3"
                    >
                        What's your name?
                    </label>
                    <input
                        data-guest-name-input
                        type="text"
                        id="guest-name-input"
                        class="w-full border-2 border-stone-200 rounded-xl py-3 px-4 text-lg bg-white/70 backdrop-blur-sm focus:border-emerald-300 focus:ring-4 focus:ring-emerald-100 focus:outline-none transition-all duration-200 placeholder-stone-400"
                        placeholder="Type your name here..."
                    />
                </div>

                <!-- Search hint -->
                <div class="text-center">
                    <p
                        data-guest-name-button-list-hint
                        class="text-stone-400 text-sm"
                    >
                    </p>
                </div>
            </section>

            <!-- Guest List Section -->
            <section class="flex-grow min-h-0 flex flex-col gap-4">
                <div
                    hidden
                    data-guest-name-button-list
                    class="flex-grow min-h-0"
                >
                    <div
                        class="bg-white/60 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 overflow-hidden"
                    >
                        <div
                            class="p-4 bg-gradient-to-r from-emerald-50 to-sky-50 border-b border-stone-200"
                        >
                            <h3
                                class="font-semibold text-stone-700 text-center"
                            >
                                Select Your Name üìù
                            </h3>
                        </div>
                        <ul class="max-h-80 overflow-y-auto">
                            {
                                guests.map((guest, index) => (
                                    <li
                                        class={
                                            index > 0
                                                ? "border-t border-stone-100"
                                                : ""
                                        }
                                    >
                                        <button
                                            data-guest-name-button
                                            data-guest={JSON.stringify(guest)}
                                            class="w-full px-6 py-4 text-left hover:bg-gradient-to-r hover:from-rose-50 hover:to-orange-50 focus:from-rose-50 focus:to-orange-50 focus:outline-none transition-all duration-200 group"
                                        >
                                            <span class="text-stone-700 font-medium group-hover:text-stone-800 transition-colors">
                                                {guest.displayName}
                                            </span>
                                        </button>
                                    </li>
                                ))
                            }
                        </ul>
                    </div>
                </div>

                <button
                    data-search-button
                    hidden
                    class="w-full bg-gradient-to-r from-emerald-400 to-emerald-500 hover:from-emerald-500 hover:to-emerald-600 py-4 px-6 text-white font-semibold text-lg rounded-xl transform hover:scale-[1.02] active:scale-[0.98] transition-all duration-200 shadow-lg hover:shadow-xl"
                >
                    Find My Seat ‚ú®
                </button>
            </section>

            <!-- Scroll hint -->
            <section>
                <p
                    data-guest-name-button-list-bottom-hint
                    hidden
                    class="text-center text-stone-400 text-sm py-2"
                >
                    ‚¨áÔ∏è Scroll down to find your name ‚¨áÔ∏è
                </p>
            </section>
        </div>

        <!-- Footer -->
        <footer class="relative z-10 mt-8 text-center">
            <div
                class="bg-white/40 backdrop-blur-sm rounded-2xl px-6 py-3 border border-white/20 inline-block"
            >
                <a
                    href="/"
                    class="text-stone-500 text-sm font-medium hover:text-stone-600 transition-colors"
                >
                    whereismyseat.gjt.io üåê
                </a>
            </div>
        </footer>
    </div>
    <script src="../../../scripts/event-home-page.ts"></script>
</BaseLayout>
