---
import BaseLayout from "../../../../layouts/Layout.astro";
import { Image } from "astro:assets";
import { tryGetEventDataAsync } from "../../../../scripts/db";

export const prerender = false;
const { eventSlug, tableSlug } = Astro.params;
const guestName = Astro.url.searchParams.get("guestName");

const event = await tryGetEventDataAsync(eventSlug!);
if (event == null)
    return new Response(null, {
        status: 404,
        statusText: `cannot find event ${eventSlug}`,
    });

const tables = event.tables.filter((table) => table.tableId == tableSlug);
if (tables.length == 0 || tables.length > 1)
    return new Response(null, {
        status: 404,
        statusText: `cannot find table ${tableSlug}`,
    });

const table = tables[0];
const imageURL = table.imageUrl;
---

<BaseLayout>
    <div
        class="h-dvh bg-gradient-to-br from-emerald-50 via-sky-50 to-orange-50 p-4 flex flex-col"
    >
        <!-- Main content -->
        <div
            class="relative z-10 flex flex-col flex-grow max-w-2xl mx-auto w-full"
        >
            <!-- Welcome Header -->
            <section class="text-center py-2">
                <div class="text-4xl mb-2">🎉</div>
                <h1 class="font-serif text-2xl text-stone-700 mb-1">
                    Welcome, {guestName}!
                </h1>
                <p class="text-stone-500 text-sm">
                    Here's your seat at our celebration ✨
                </p>
            </section>

            <!-- Table Image Section -->
            <section
                class="flex-grow flex flex-col justify-center items-center my-4 min-h-0"
            >
                <div
                    class="bg-white/70 backdrop-blur-sm rounded-3xl p-4 shadow-xl border border-white/30 max-w-full flex flex-col max-h-full"
                >
                    <div class="mb-2 text-center">
                        <h2 class="text-xl font-semibold text-stone-700">
                            Table {tableSlug}
                        </h2>
                    </div>

                    <div
                        class="bg-white rounded-2xl p-2 shadow-inner flex-grow flex justify-center items-center"
                    >
                        <Image
                            src={imageURL}
                            alt={"Seating arrangement for table " + tableSlug}
                            width="1000"
                            height="1000"
                            class="w-auto h-full rounded-xl object-contain"
                        />
                    </div>

                    <div class="mt-2 text-center">
                        <p class="text-stone-600 text-xs">
                            Take a screenshot to save this for later! 📸
                        </p>
                    </div>
                </div>
            </section>

            <!-- Navigation Section -->
            <section class="flex gap-4 max-w-sm mx-auto w-full">
                <a
                    href=`/e/${eventSlug}`
                    class="flex-1 bg-white/70 backdrop-blur-sm border-2 border-stone-200 hover:border-stone-300 text-stone-600 font-semibold text-sm py-3 px-4 rounded-2xl text-center transition-all duration-200 shadow-md hover:shadow-lg"
                >
                    ⬅️ Back
                </a>

                <a
                    href="/"
                    class="flex-1 bg-gradient-to-r from-emerald-400 to-emerald-500 hover:from-emerald-500 hover:to-emerald-600 text-white font-semibold text-sm py-3 px-4 rounded-2xl text-center transition-all duration-200 shadow-lg hover:shadow-xl"
                >
                    Home 🏠
                </a>
            </section>

            <!-- Help text -->
            <section class="text-center mt-4">
                <p class="text-stone-400 text-xs">
                    Need help finding your table? Ask our wedding coordinators!
                    💕
                </p>
            </section>
        </div>
    </div>
</BaseLayout>