---
import BaseLayout from "../../../../layouts/Layout.astro";
import { Image } from "astro:assets";
import { tryGetEventDataAsync } from "../../../../scripts/db";

export const prerender = false;
const { eventSlug, tableSlug } = Astro.params;
const guestName = Astro.url.searchParams.get("guestName");

const event = await tryGetEventDataAsync(eventSlug!);
if (event == null)
    return new Response(null, {
        status: 404,
        statusText: `cannot find event ${eventSlug}`,
    });

const tables = event.tables.filter((table) => table.tableId == tableSlug);
if (tables.length == 0 || tables.length > 1)
    return new Response(null, {
        status: 404,
        statusText: `cannot find table ${tableSlug}`,
    });

const table = tables[0];
const imageURL = table.imageUrl;
---

<BaseLayout>
    <div
        class="min-h-dvh bg-gradient-to-br from-emerald-50 via-sky-50 to-orange-50 p-4 flex flex-col"
    >
        <!-- Main content -->
        <div
            class="relative z-10 flex flex-col flex-grow max-w-2xl mx-auto w-full"
        >
            <!-- Welcome Header -->
            <section class="text-center py-6">
                <div class="mb-4">
                    <div class="text-5xl mb-3">🎉</div>
                    <h1
                        class="font-serif text-3xl md:text-4xl text-stone-700 mb-3"
                    >
                        Welcome, {guestName}!
                    </h1>
                    <p class="text-stone-500 text-lg leading-relaxed">
                        Here's your seat at our celebration ✨
                    </p>
                </div>

                <!-- Decorative divider -->
                <div class="flex items-center justify-center mb-6">
                    <div class="w-8 h-px bg-stone-300"></div>
                    <div class="mx-3 text-stone-400">💍</div>
                    <div class="w-8 h-px bg-stone-300"></div>
                </div>
            </section>

            <!-- Table Image Section -->
            <section
                class="flex-grow flex flex-col justify-center items-center mb-8"
            >
                <div
                    class="bg-white/70 backdrop-blur-sm rounded-3xl p-6 shadow-xl border border-white/30 max-w-full"
                >
                    <div class="mb-4 text-center">
                        <h2 class="text-2xl font-semibold text-stone-700 mb-2">
                            Table {tableSlug}
                        </h2>
                        <p class="text-stone-500">
                            Your spot is waiting for you! 🪑
                        </p>
                    </div>

                    <div class="bg-white rounded-2xl p-4 shadow-inner">
                        <Image
                            src={imageURL}
                            alt={"Seating arrangement for table " + tableSlug}
                            width="1000"
                            height="1000"
                            class="w-full h-auto rounded-xl"
                        />
                    </div>

                    <div class="mt-4 text-center">
                        <p class="text-stone-600 text-sm">
                            Take a screenshot to save this for later! 📸
                        </p>
                    </div>
                </div>
            </section>

            <!-- Navigation Section -->
            <section class="flex flex-col gap-4 max-w-sm mx-auto w-full">
                <a
                    href=`/e/${eventSlug}`
                    class="bg-gradient-to-r from-emerald-400 to-emerald-500 hover:from-emerald-500 hover:to-emerald-600 text-white font-semibold text-lg py-4 px-8 rounded-2xl text-center transform hover:scale-[1.02] active:scale-[0.98] transition-all duration-200 shadow-lg hover:shadow-xl"
                >
                    ⬅️ Back to Guest List
                </a>

                <a
                    href="/"
                    class="bg-white/70 backdrop-blur-sm border-2 border-stone-200 hover:border-stone-300 text-stone-600 font-semibold text-lg py-4 px-8 rounded-2xl text-center transform hover:scale-[1.02] active:scale-[0.98] transition-all duration-200 shadow-md hover:shadow-lg"
                >
                    🏠 Home
                </a>
            </section>

            <!-- Help text -->
            <section class="text-center mt-6">
                <p class="text-stone-400 text-sm">
                    Need help finding your table? <br />
                    <span class="text-stone-500 font-medium"
                        >Ask our wedding coordinators! 💕</span
                    >
                </p>
            </section>
        </div>
    </div>
</BaseLayout>
